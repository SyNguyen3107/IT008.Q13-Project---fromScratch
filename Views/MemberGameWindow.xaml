<Window x:Class="EasyFlips.Views.MemberGameWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:cv="clr-namespace:EasyFlips.Converters"
        xmlns:i="http://schemas.microsoft.com/xaml/behaviors"
        mc:Ignorable="d"
        Title="EasyFlips - Member Game" Height="750" Width="1100"
        WindowStartupLocation="CenterScreen"
        Background="{StaticResource Brush.Dark}">
    <i:Interaction.Triggers>
        <i:EventTrigger EventName="Closing">
            <i:InvokeCommandAction Command="{Binding WindowClosingCommand}" 
                           PassEventArgsToCommand="True"/>
        </i:EventTrigger>
    </i:Interaction.Triggers>
    <Window.Resources>
        <cv:BooleanToVisibilityConverter x:Key="BoolToVis"/>
        <cv:NullToCollapsedConverter x:Key="NullToCollapsedConverter"/>
        <cv:ImagePathConverter x:Key="ImagePathConverter"/>

        <DropShadowEffect x:Key="CardShadow" Color="Black" Opacity="0.4" BlurRadius="25" ShadowDepth="0"/>

        <Style x:Key="QuitButtonStyle" TargetType="Button">
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="bdr" CornerRadius="8" Padding="15,8">
                            <Border.Background>
                                <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                                    <GradientStop Color="#EB3349" Offset="0"/>
                                    <GradientStop Color="#F45C43" Offset="1"/>
                                </LinearGradientBrush>
                            </Border.Background>
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="bdr" Property="Opacity" Value="0.9"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="ModernTextBoxStyle" TargetType="TextBox">
            <Setter Property="Background" Value="{StaticResource Brush.Surface}"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="FontSize" Value="18"/>
            <Setter Property="CaretBrush" Value="{StaticResource Brush.Accent1}"/>
            <Setter Property="Padding" Value="18,0"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="BorderBrush" Value="#33FFFFFF"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="TextBox">
                        <Border x:Name="border" Background="{TemplateBinding Background}" 
                                BorderBrush="{TemplateBinding BorderBrush}" 
                                BorderThickness="{TemplateBinding BorderThickness}" 
                                CornerRadius="12">
                            <ScrollViewer x:Name="PART_ContentHost" Margin="5,0"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsFocused" Value="True">
                                <Setter TargetName="border" Property="BorderBrush" Value="{StaticResource Brush.Primary}"/>
                                <Setter TargetName="border" Property="Background" Value="#35393E"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="ModernButtonStyle" TargetType="Button">
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="FontSize" Value="15"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="bdr" CornerRadius="12">
                            <Border.Background>
                                <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                    <GradientStop Color="{StaticResource Color.Primary}" Offset="0"/>
                                    <GradientStop Color="{StaticResource Color.Secondary}" Offset="1"/>
                                </LinearGradientBrush>
                            </Border.Background>
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="bdr" Property="Opacity" Value="0.9"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter Property="RenderTransform">
                                    <Setter.Value>
                                        <ScaleTransform ScaleX="0.96" ScaleY="0.96"/>
                                    </Setter.Value>
                                </Setter>
                                <Setter Property="RenderTransformOrigin" Value="0.5,0.5"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        <Style x:Key="ScrollBarButtonStyle" TargetType="RepeatButton">
            <Setter Property="Focusable" Value="False"/>
            <Setter Property="IsTabStop" Value="False"/>
            <Setter Property="Visibility" Value="Collapsed"/>
        </Style>

        <Style x:Key="ScrollBarThumbStyle" TargetType="Thumb">
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Thumb">
                        <Border x:Name="rectangle" Background="#40FFFFFF" CornerRadius="4" 
                        Margin="2,0" SnapsToDevicePixels="True" />
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="rectangle" Property="Background" Value="#60FFFFFF"/>
                            </Trigger>
                            <Trigger Property="IsDragging" Value="True">
                                <Setter TargetName="rectangle" Property="Background" Value="{StaticResource Brush.Primary}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style TargetType="ScrollBar">
            <Setter Property="Stylus.IsPressAndHoldEnabled" Value="false"/>
            <Setter Property="Stylus.IsFlicksEnabled" Value="false"/>
            <Setter Property="Width" Value="8"/>
            <Setter Property="Margin" Value="2,0"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ScrollBar">
                        <Grid x:Name="Bg" SnapsToDevicePixels="true" Background="Transparent">
                            <Track x:Name="PART_Track" IsDirectionReversed="true" IsEnabled="{TemplateBinding IsEnabled}">
                                <Track.DecreaseRepeatButton>
                                    <RepeatButton Style="{StaticResource ScrollBarButtonStyle}" Command="{x:Static ScrollBar.PageUpCommand}" />
                                </Track.DecreaseRepeatButton>
                                <Track.IncreaseRepeatButton>
                                    <RepeatButton Style="{StaticResource ScrollBarButtonStyle}" Command="{x:Static ScrollBar.PageDownCommand}" />
                                </Track.IncreaseRepeatButton>
                                <Track.Thumb>
                                    <Thumb Style="{StaticResource ScrollBarThumbStyle}" />
                                </Track.Thumb>
                            </Track>
                        </Grid>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style TargetType="ScrollViewer">
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ScrollViewer">
                        <Grid x:Name="Grid" Background="{TemplateBinding Background}">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="*"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>
                            <ScrollContentPresenter x:Name="PART_ScrollContentPresenter" CanContentScroll="{TemplateBinding CanContentScroll}" CanHorizontallyScroll="False" CanVerticallyScroll="False" ContentTemplate="{TemplateBinding ContentTemplate}" Content="{TemplateBinding Content}" Grid.Column="0" Margin="{TemplateBinding Padding}" Grid.Row="0"/>
                            <ScrollBar x:Name="PART_VerticalScrollBar" AutomationProperties.AutomationId="VerticalScrollBar" Cursor="Arrow" Grid.Column="1" Maximum="{TemplateBinding ScrollableHeight}" Minimum="0" Grid.Row="0" Visibility="{TemplateBinding ComputedVerticalScrollBarVisibility}" Value="{Binding VerticalOffset, Mode=OneWay, RelativeSource={RelativeSource TemplatedParent}}" ViewportSize="{TemplateBinding ViewportHeight}"/>
                        </Grid>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Window.Resources>

    <Grid>
        <Canvas IsHitTestVisible="False">
            <Ellipse Width="600" Height="600" Canvas.Left="-200" Canvas.Top="-200" Opacity="0.12">
                <Ellipse.Fill>
                    <RadialGradientBrush>
                        <GradientStop Color="{StaticResource Color.Primary}" Offset="0"/>
                        <GradientStop Color="Transparent" Offset="1"/>
                    </RadialGradientBrush>
                </Ellipse.Fill>
            </Ellipse>
        </Canvas>

        <Grid Margin="40,30">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <Grid Grid.Row="0" Margin="0,0,0,10">
                <StackPanel HorizontalAlignment="Left">
                    <TextBlock Text="TOTAL SCORE" Foreground="{StaticResource Brush.TextSecondary}" FontSize="11" FontWeight="Bold" Margin="2,0,0,2"/>
                    <TextBlock Text="{Binding Score}" Foreground="{StaticResource Brush.Accent2}" FontSize="38" FontWeight="ExtraBold"/>
                </StackPanel>

                <StackPanel HorizontalAlignment="Right" Orientation="Horizontal" VerticalAlignment="Center">
                    <Border CornerRadius="12" Padding="15,8" Margin="0,0,12,0">
                        <Border.Style>
                            <Style TargetType="Border">
                                <Setter Property="Background" Value="#1560A5FA"/>
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding IsShowingResult}" Value="True">
                                        <Setter Property="Background" Value="#15FACC15"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </Border.Style>

                        <StackPanel Orientation="Horizontal">
                            <Ellipse Width="8" Height="8" Margin="0,0,10,0" VerticalAlignment="Center">
                                <Ellipse.Style>
                                    <Style TargetType="Ellipse">
                                        <Setter Property="Fill" Value="#60A5FA"/>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding IsShowingResult}" Value="True">
                                                <Setter Property="Fill" Value="#FACC15"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </Ellipse.Style>
                            </Ellipse>

                            <TextBlock FontSize="13" FontWeight="ExtraBold" VerticalAlignment="Center">
                                <TextBlock.Style>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="Text" Value="IN GAME"/>
                                        <Setter Property="Foreground" Value="#60A5FA"/>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding IsShowingResult}" Value="True">
                                                <Setter Property="Text" Value="REVIEWING"/>
                                                <Setter Property="Foreground" Value="#FACC15"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </TextBlock.Style>
                            </TextBlock>
                        </StackPanel>
                    </Border>

                    <Border Background="#1AFFFFFF" CornerRadius="12" Padding="15,8" Margin="0,0,12,0">
                        <TextBlock Text="{Binding CurrentQuestionInfo}" Foreground="White" FontSize="14" FontWeight="Bold"/>
                    </Border>

                    <Button Command="{Binding QuitGameCommand}" 
                            Content="LEAVE ROOM"
                            Style="{StaticResource QuitButtonStyle}"/>
                </StackPanel>
            </Grid>

            <StackPanel Grid.Row="1" HorizontalAlignment="Center" Margin="0,0,0,30">
                <TextBlock Text="{Binding GameStatusText}" HorizontalAlignment="Center" FontSize="12" FontWeight="Bold" Margin="0,0,0,5">
                    <TextBlock.Style>
                        <Style TargetType="TextBlock">
                            <Setter Property="Foreground" Value="{StaticResource Brush.TextSecondary}"/>
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding IsShowingResult}" Value="True">
                                    <Setter Property="Foreground" Value="{StaticResource Brush.Accent1}"/>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </TextBlock.Style>
                </TextBlock>

                <Border Background="#15FFFFFF" CornerRadius="20" Padding="50,5" HorizontalAlignment="Center">
                    <TextBlock Text="{Binding TimeRemaining}" FontSize="28" FontWeight="Bold">
                        <TextBlock.Style>
                            <Style TargetType="TextBlock">
                                <Setter Property="Foreground" Value="White"/>
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding TimeRemaining}" Value="5">
                                        <Setter Property="Foreground" Value="#FF6B6B"/>
                                    </DataTrigger>
                                    <DataTrigger Binding="{Binding TimeRemaining}" Value="4">
                                        <Setter Property="Foreground" Value="#FF6B6B"/>
                                    </DataTrigger>
                                    <DataTrigger Binding="{Binding TimeRemaining}" Value="3">
                                        <Setter Property="Foreground" Value="#FF6B6B"/>
                                    </DataTrigger>
                                    <DataTrigger Binding="{Binding TimeRemaining}" Value="2">
                                        <Setter Property="Foreground" Value="#FF6B6B"/>
                                    </DataTrigger>
                                    <DataTrigger Binding="{Binding TimeRemaining}" Value="1">
                                        <Setter Property="Foreground" Value="#FF6B6B"/>
                                    </DataTrigger>
                                    <DataTrigger Binding="{Binding TimeRemaining}" Value="0">
                                        <Setter Property="Foreground" Value="#FF6B6B"/>
                                    </DataTrigger>
                                    <DataTrigger Binding="{Binding IsShowingResult}" Value="True">
                                        <Setter Property="Foreground" Value="#4ADE80"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </TextBlock.Style>
                    </TextBlock>
                </Border>
            </StackPanel>

            <Viewbox Grid.Row="2" VerticalAlignment="Center" MaxHeight="460" Margin="0,0,0,40">
                <Border Width="800" Height="460" Background="{StaticResource Brush.Surface}" CornerRadius="28" Effect="{StaticResource CardShadow}">
                    <Grid Margin="45">
                        <Grid x:Name="FrontFace">
                            <Grid.Style>
                                <Style TargetType="Grid">
                                    <Setter Property="Visibility" Value="Visible"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding IsShowingResult}" Value="True">
                                            <Setter Property="Visibility" Value="Collapsed"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Grid.Style>
                            <ScrollViewer VerticalScrollBarVisibility="Visible" HorizontalScrollBarVisibility="Disabled">
                                <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                                    <Image Source="{Binding CurrentCard.FrontImagePath, Converter={StaticResource ImagePathConverter}}" 
                                           Visibility="{Binding CurrentCard.FrontImagePath, Converter={StaticResource NullToCollapsedConverter}}"
                                           Stretch="Uniform" Margin="0,0,0,15" MaxHeight="280"/>
                                    <TextBlock Text="{Binding CurrentCard.FrontText, TargetNullValue='Loading...'}" 
                                               Foreground="White" FontSize="40" FontWeight="Bold" TextAlignment="Center" TextWrapping="Wrap"/>
                                    <Button Command="{Binding PlayAudioCommand}" 
                                            CommandParameter="{Binding CurrentCard.FrontAudioPath}"
                                            Width="40" Height="40" Margin="0,30,0,0" HorizontalAlignment="Center"
                                            Background="Transparent" BorderThickness="0" Cursor="Hand"
                                            Visibility="{Binding CurrentCard.FrontAudioPath, Converter={StaticResource NullToCollapsedConverter}}">
                                        <Button.Template>
                                            <ControlTemplate TargetType="Button">
                                                <Border x:Name="bdr" Background="{TemplateBinding Background}" CornerRadius="20">
                                                    <TextBlock Text="🔊" FontSize="20" Foreground="#6C5DD3" 
                                                               HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                </Border>
                                                <ControlTemplate.Triggers>
                                                    <Trigger Property="IsMouseOver" Value="True">
                                                        <Setter TargetName="bdr" Property="Background" Value="#20FFFFFF"/>
                                                    </Trigger>
                                                </ControlTemplate.Triggers>
                                            </ControlTemplate>
                                        </Button.Template>
                                    </Button>
                                </StackPanel>
                            </ScrollViewer>
                        </Grid>

                        <Grid x:Name="BackFace">
                            <Grid.Style>
                                <Style TargetType="Grid">
                                    <Setter Property="Visibility" Value="Collapsed"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding IsShowingResult}" Value="True">
                                            <Setter Property="Visibility" Value="Visible"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Grid.Style>

                            <ScrollViewer VerticalScrollBarVisibility="Auto" 
                  HorizontalScrollBarVisibility="Disabled">
                                <StackPanel VerticalAlignment="Center" Margin="0,10">
                                    <TextBlock Text="{Binding ResultMessage}" FontSize="28" FontWeight="Bold" 
                       TextAlignment="Center" Margin="0,0,0,20">
                                        <TextBlock.Style>
                                            <Style TargetType="TextBlock">
                                                <Setter Property="Foreground" Value="#FF6B6B"/>
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding IsCorrect}" Value="True">
                                                        <Setter Property="Foreground" Value="#4ADE80"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </TextBlock.Style>
                                    </TextBlock>

                                    <ItemsControl ItemsSource="{Binding ComparisonPieces}" HorizontalAlignment="Center" Margin="0,0,0,10">
                                        <ItemsControl.ItemsPanel>
                                            <ItemsPanelTemplate>
                                                <WrapPanel Orientation="Horizontal" HorizontalAlignment="Center"/>
                                            </ItemsPanelTemplate>
                                        </ItemsControl.ItemsPanel>
                                        <ItemsControl.ItemTemplate>
                                            <DataTemplate>
                                                <TextBlock Text="{Binding Text}" FontSize="26" Margin="1,0"
                                   Foreground="{Binding Type, Converter={StaticResource DiffTypeToBrushConverter}}"
                                   TextDecorations="{Binding Type, Converter={StaticResource DiffTypeToTextDecorationConverter}}"/>
                                            </DataTemplate>
                                        </ItemsControl.ItemTemplate>
                                    </ItemsControl>

                                    <Border Background="#10FFFFFF" CornerRadius="10" Padding="15,8" 
                                         HorizontalAlignment="Center" Margin="0,0,0,25">
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock Text="CORRECT: " Foreground="Gray" FontSize="13" FontWeight="Bold" VerticalAlignment="Center"/>
                                            <TextBlock Text="{Binding CorrectAnswer}" Foreground="#2ECC71" FontSize="22" 
                                          FontWeight="Bold" VerticalAlignment="Center" Margin="5,0,0,0"/>
                                        </StackPanel>
                                    </Border>

                                    <Button Command="{Binding PlayAudioCommand}" 
                                            CommandParameter="{Binding CurrentCard.BackAudioPath}"
                                            Width="40" Height="40" Margin="0,0,0,15" HorizontalAlignment="Center"
                                            Background="Transparent" BorderThickness="0" Cursor="Hand"
                                            Visibility="{Binding CurrentCard.BackAudioPath, Converter={StaticResource NullToCollapsedConverter}}">
                                        <Button.Template>
                                            <ControlTemplate TargetType="Button">
                                                <Border x:Name="bdr" Background="{TemplateBinding Background}" CornerRadius="20">
                                                    <TextBlock Text="🔊" FontSize="20" Foreground="#FFCE73" 
                                                               HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                </Border>
                                                <ControlTemplate.Triggers>
                                                    <Trigger Property="IsMouseOver" Value="True">
                                                        <Setter TargetName="bdr" Property="Background" Value="#20FFFFFF"/>
                                                    </Trigger>
                                                </ControlTemplate.Triggers>
                                            </ControlTemplate>
                                        </Button.Template>
                                    </Button>
                                    <TextBlock Text="{Binding CurrentCard.BackText}" Foreground="White" FontSize="48" 
                                               FontWeight="ExtraBold" TextAlignment="Center" TextWrapping="Wrap"/>
                                </StackPanel>
                            </ScrollViewer>
                        </Grid>
                    </Grid>
                </Border>
            </Viewbox>

            <Grid Grid.Row="3" Width="850" HorizontalAlignment="Center">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="200"/>
                </Grid.ColumnDefinitions>
                <TextBox Style="{StaticResource ModernTextBoxStyle}" Height="60" Margin="0,0,15,0"
                         Text="{Binding UserAnswer, UpdateSourceTrigger=PropertyChanged}" 
                         IsEnabled="{Binding IsInputEnabled}">
                    <TextBox.InputBindings>
                        <KeyBinding Key="Enter" Command="{Binding SubmitAnswerCommand}"/>
                    </TextBox.InputBindings>
                </TextBox>
                <Button Grid.Column="1" Height="60" 
                        Style="{StaticResource ModernButtonStyle}" 
                        Command="{Binding SubmitAnswerCommand}">

                    <Grid>
                        <TextBlock Text="SUBMIT" VerticalAlignment="Center" HorizontalAlignment="Center">
                            <TextBlock.Style>
                                <Style TargetType="TextBlock">
                                    <Setter Property="Visibility" Value="Visible"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding IsInputEnabled}" Value="False">
                                            <Setter Property="Visibility" Value="Collapsed"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </TextBlock.Style>
                        </TextBlock>

                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center" HorizontalAlignment="Center">
                            <StackPanel.Style>
                                <Style TargetType="StackPanel">
                                    <Setter Property="Visibility" Value="Collapsed"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding IsInputEnabled}" Value="False">
                                            <Setter Property="Visibility" Value="Visible"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </StackPanel.Style>
                            <TextBlock Text="WAITING" />
                            <TextBlock Text="..." x:Name="dots">
                                <TextBlock.Triggers>
                                    <EventTrigger RoutedEvent="Loaded">
                                        <BeginStoryboard>
                                            <Storyboard RepeatBehavior="Forever">
                                                <DoubleAnimation Storyboard.TargetProperty="Opacity" From="1" To="0.2" Duration="0:0:0.5" AutoReverse="True"/>
                                            </Storyboard>
                                        </BeginStoryboard>
                                    </EventTrigger>
                                </TextBlock.Triggers>
                            </TextBlock>
                        </StackPanel>
                    </Grid>
                </Button>
            </Grid>
        </Grid>
        <Grid x:Name="CountdownOverlay" 
              Visibility="{Binding IsShowingStartCountdown, Converter={StaticResource BoolToVis}}"
              Panel.ZIndex="100">
            <Border Background="#F21A1A1A"/>

            <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                <TextBlock Text="STARING IN" 
                           Foreground="{StaticResource Brush.TextSecondary}" 
                           FontSize="18" 
                           FontWeight="Bold" 
                           HorizontalAlignment="Center"
                           Margin="0,0,0,10"/>

                <TextBlock Text="{Binding StartCountdownValue, NotifyOnTargetUpdated=True}" 
                   Foreground="{StaticResource Brush.Accent2}" 
                   FontSize="180" 
                   FontWeight="Black" 
                   HorizontalAlignment="Center"
                   RenderTransformOrigin="0.5,0.5">

                    <TextBlock.RenderTransform>
                        <ScaleTransform x:Name="NumberScale" ScaleX="1" ScaleY="1"/>
                    </TextBlock.RenderTransform>

                    <TextBlock.Triggers>
                        <EventTrigger RoutedEvent="Binding.TargetUpdated">
                            <BeginStoryboard>
                                <Storyboard>
                                    <DoubleAnimation Storyboard.TargetProperty="(UIElement.RenderTransform).(ScaleTransform.ScaleX)"
                                     From="2.0" To="1.0" Duration="0:0:0.5">
                                        <DoubleAnimation.EasingFunction>
                                            <BackEase Amplitude="1" EasingMode="EaseOut"/>
                                        </DoubleAnimation.EasingFunction>
                                    </DoubleAnimation>
                                    <DoubleAnimation Storyboard.TargetProperty="(UIElement.RenderTransform).(ScaleTransform.ScaleY)"
                                     From="2.0" To="1.0" Duration="0:0:0.5">
                                        <DoubleAnimation.EasingFunction>
                                            <BackEase Amplitude="1" EasingMode="EaseOut"/>
                                        </DoubleAnimation.EasingFunction>
                                    </DoubleAnimation>
                                </Storyboard>
                            </BeginStoryboard>
                        </EventTrigger>
                    </TextBlock.Triggers>
                </TextBlock>
            </StackPanel>
        </Grid>
    </Grid>
</Window>